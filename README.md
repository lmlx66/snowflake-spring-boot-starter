# å¼€ç®±å³ç”¨çš„javaé›ªèŠ±ç®—æ³•ï¼ˆyitter-idgenerator-spring-boot-starterï¼‰

### 1ã€ä»‹ç»

é›ªèŠ±ç®—æ³•æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ä¸»é”®idç”Ÿæˆçš„è§£å†³æ–¹æ¡ˆï¼Œä»–è§£å†³äº†åˆ†å¸ƒå¼idç”Ÿæˆçš„ç—›ç‚¹é—®é¢˜ã€‚

æœ¬é¡¹ç›®ä¾èµ–äº[SnowFlake IdGenerator](https://gitee.com/yitter/idgenerator)æ ¸å¿ƒä»£ç ï¼ŒåŠ å…¥springbootè‡ªåŠ¨é…ç½®ï¼Œä»è€Œè¾¾åˆ°å¼€ç®±å³ç”¨çš„æ•ˆæœã€‚è¯¥ç®—æ³•åœ¨ç¼©çŸ­IDé•¿åº¦çš„åŒæ—¶ï¼Œå…·å¤‡æé«˜ç¬æ—¶å¹¶å‘å¤„ç†èƒ½åŠ›ï¼ˆ50W/0.1sï¼‰ã€‚å¹¶ä¸”æ”¯æŒå›æ‹¨ã€‚



### 2ã€æŠ€æœ¯æ”¯æŒ

æœ¬åŒ…åŸºäº[å¤šè¯­è¨€æ–°é›ªèŠ±ç®—æ³•(SnowFlake IdGenerator)](https://gitee.com/yitter/idgenerator)æ ¸å¿ƒä»£ç å®ç°ï¼Œå…³äºè¯¥ç®—æ³•æ›´å¤šç»†èŠ‚è¯·å‚è€ƒå…¶é¡¹ç›®åœ°å€ã€‚



### 3ã€ç®—æ³•ç‰¹ç‚¹

âœ” æ•´å½¢æ•°å­—ï¼Œéšæ—¶é—´å•è°ƒé€’å¢ï¼ˆä¸ä¸€å®šè¿ç»­ï¼‰ï¼Œé•¿åº¦æ›´çŸ­ï¼Œç”¨50å¹´éƒ½ä¸ä¼šè¶…è¿‡ js Numberç±»å‹æœ€å¤§å€¼ã€‚ï¼ˆé»˜è®¤é…ç½®ï¼‰

âœ” é€Ÿåº¦æ›´å¿«ï¼Œæ˜¯ä¼ ç»Ÿé›ªèŠ±ç®—æ³•çš„2-5å€ï¼Œ0.1ç§’å¯ç”Ÿæˆ50ä¸‡ä¸ªï¼ˆåŸºäº8ä»£ä½å‹i7ï¼‰ã€‚

âœ” æ”¯æŒæ—¶é—´å›æ‹¨å¤„ç†ã€‚æ¯”å¦‚æœåŠ¡å™¨æ—¶é—´å›æ‹¨1ç§’ï¼Œæœ¬ç®—æ³•èƒ½è‡ªåŠ¨é€‚åº”ç”Ÿæˆä¸´ç•Œæ—¶é—´çš„å”¯ä¸€IDã€‚

âœ” æ”¯æŒæ‰‹å·¥æ’å…¥æ–°IDã€‚å½“ä¸šåŠ¡éœ€è¦åœ¨å†å²æ—¶é—´ç”Ÿæˆæ–°IDæ—¶ï¼Œç”¨æœ¬ç®—æ³•çš„é¢„ç•™ä½èƒ½ç”Ÿæˆ5000ä¸ªæ¯ç§’ã€‚

âœ” ä¸ä¾èµ–ä»»ä½•å¤–éƒ¨ç¼“å­˜å’Œæ•°æ®åº“ã€‚ï¼ˆk8sç¯å¢ƒä¸‹è‡ªåŠ¨æ³¨å†Œ WorkerId çš„åŠ¨æ€åº“ä¾èµ– redisï¼‰

âœ” åŸºç¡€åŠŸèƒ½ï¼Œå¼€ç®±å³ç”¨ï¼Œæ— éœ€é…ç½®æ–‡ä»¶ã€æ•°æ®åº“è¿æ¥ç­‰ã€‚

âœ”æ”¯æŒå¾®æœåŠ¡åŠ¨æ€é…ç½®ï¼Œä¼šåŠ¨æ€åŠ è½½å•ä¾‹beanï¼Œé€šè¿‡åŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶ï¼Œè€Œå®ç°è‡ªåŠ¨æ³¨å†Œæœºå™¨ç ã€‚



### 4ã€å¦‚ä½•ä½¿ç”¨

#### 4.1ã€springbootä½¿ç”¨

1.å¼•å…¥mavenä¾èµ–ã€‚

[yitter-idgenerator-spring-boot-starterçš„mavenä»“åº“åœ°å€](https://repo1.maven.org/maven2/io/github/lmlx66/yitter-idgenerator-spring-boot-starter/)

``` xml
<dependency>
  <groupId>io.github.lmlx66</groupId>
  <artifactId>yitter-idgenerator-spring-boot-starter</artifactId>
  <version>1.0.8</version>
</dependency>
```



2.æ³¨å…¥ç”Ÿæˆå™¨`YitIdGenerator`å¹¶è°ƒç”¨`next`æ–¹æ³•

``` java
@RestController
public class IdController {
   
    @Autowired
    private YitIdGenerator yitIdGenerator;
    
    @GetMapping("getId")
    public long getId(){
        return yitIdGenerator.next();
    } 
}
```

æ˜¯ä¸æ˜¯éå¸¸ç®€å•å‘¢ï¼Ÿ



3.å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å¯¹ç®€å•é…ç½®ä¸€ä¸‹

```yaml
yitter:
  monomer: false # ä¸å¼€å¯å•æœºæ¨¡å¼
  method: 1 # 1ä¸ºé›ªèŠ±æ¼‚ç§»ç®—æ³•ï¼Œ2ä¸ºä¼ ç»Ÿç®—æ³•
  worker-id: 2 # æœºå™¨ç id
```



#### 4.1ã€mybatis-plusä¾èµ–

æˆ‘ä»¬ä¹Ÿé€‚é…äº†mybatis-plusä¸»é”®ç”Ÿæˆç­–ç•¥ï¼Œå½“ç„¶ä½ å¼•å…¥äº†æ­¤ä¾èµ–ï¼Œå°±ä¸éœ€è¦å¼•å…¥ä¸Šé¢springbootçš„ä¾èµ–äº†

1.å¼•å…¥ä¾èµ–

[mavenä»“åº“åœ°å€](https://repo1.maven.org/maven2/io/github/lmlx66/yitter-idgenerator-spring-boot-starter/)

``` xml
<dependency>
  <groupId>io.github.lmlx66</groupId>
  <artifactId>yitter-idgenerator-mybatisPlus-spring-boot-starter</artifactId>
  <version>1.0.8</version>
</dependency>
```



2.ä½¿ç”¨

ç›´æ¥æ³¨è§£ä½¿ç”¨ï¼Œæœ€é‡è¦çš„æ˜¯`type`ä¸º`IdType.INPUT`ï¼Œåˆ™ä¼šä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„beanï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
public class YourEntity {
    @TableId(value = "id", type = IdType.INPUT)
    private String id;
}
```



3.å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥è·Ÿä¸Šé¢ä¸€æ ·è£…é…ç”Ÿæˆå™¨`YitIdGenerator`å¹¶è°ƒç”¨`next`æ–¹æ³•

``` java
@RestController
public class IdController {
   
    @Autowired
    private YitIdGenerator yitIdGenerator;
    
    @GetMapping("getId")
    public long getId(){
        return yitIdGenerator.next();
    } 
}
```



### 5ã€é…ç½®è¯¦è§£



#### 5.1ã€é…ç½®æ–‡ä»¶é…ç½®

æˆ‘ä»¬æ”¯æŒåœ¨yamlæˆ–è€…propertiesç­‰é…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œæ³¨æ„å‰ç¼€ä¸º`yitter`

| å‚æ•°å             | é»˜è®¤å€¼         | ä½œç”¨                                        |
| ------------------ | -------------- | ------------------------------------------- |
| Methodï¼ˆshortï¼‰    | 1              | 1è¡¨ç¤ºé›ªèŠ±æ¼‚ç§»ç®—æ³•ï¼Œ2è¡¨ç¤ºä¼ ç»Ÿé›ªèŠ±ç®—æ³•        |
| Monomerï¼ˆBooleanï¼‰ | true           | trueè¡¨ç¤ºå•æœºæ¶æ„ï¼Œæœºå™¨ç é•¿ä¸º1byte,æœºå™¨ç ä¸º1 |
| BaseTimeï¼ˆlongï¼‰   | 1640966400000L | åŸºç¡€æ—¶é—´ï¼Œä¸º2022-01-01 00:00:00             |
| WorkerIdBitLength  | 6              | æœºå™¨ç ä½é•¿ï¼ˆèƒ½è¡¨ç¤ºæœºå™¨ç çš„æœ€å¤§å€¼ï¼‰          |
| WorkerId           | 0              | æœºå™¨ç ï¼ˆå½“å‰ç³»ç»Ÿçš„æœºå™¨ç ï¼‰                  |
| SeqBitLength       | 6              | åºåˆ—æ•°ä½é•¿ï¼ˆèƒ½è¡¨ç¤ºæœºå™¨ç çš„æœ€å¤§åºåˆ—æ•°ï¼‰      |
| MaxSeqNumber       | 0ï¼ˆä¸é™å®šï¼‰    | æœ€å¤§åºåˆ—æ•°ï¼ˆå«ï¼‰                            |
| MinSeqNumber       | 0ï¼ˆä¸é™å®šï¼‰    | æœ€å°åºåˆ—æ•°ï¼ˆå«ï¼‰                            |
| TopOverCostCount   | 2000           | æœ€å¤§æ¼‚ç§»æ¬¡æ•°ï¼Œä¸è®¡ç®—èƒ½åŠ›æœ‰å…³                |



#### 5.2ã€é…ç½®ç±»é…ç½®

å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿæ”¯æŒé…ç½®ç±»é…ç½®ï¼Œè¿”å›ç±»å‹ä¸ºYitIdGeneratorï¼Œå…¶æ„é€ éœ€è¦ä¸€ä¸ªIdGeneratorPropertiesç±»å‹ã€‚

IdGeneratorPropertiesæ˜¯åŸºç¡€é…ç½®ç±»å®ä½“æ˜ å°„ç±»ï¼Œå…¶å†…éƒ¨å±æ€§å³æˆ‘ä»¬å¯é…ç½®çš„å±æ€§ã€‚

ä½†è¯·æ³¨æ„ï¼Œå¦‚æœé…ç½®ç±»å’Œé…ç½®æ–‡ä»¶ï¼ˆyamlæˆ–propertiesï¼‰åŒæ—¶ä½¿ç”¨ï¼Œä¼˜å…ˆé‡‡ç”¨é…ç½®ç±»é…ç½®ã€‚

```java
@Configuration
public class IdGeneratorConfig {
    @Bean
    public YitIdGenerator yitIdGenerator() {
         //å‡†å¤‡åŸºç¡€é…ç½®ç±»ï¼Œåœ¨æ­¤å¯ä»¥é…ç½®åŸºç¡€ä¿¡æ¯
        IdGeneratorOptions idGeneratorOptions = new IdGeneratorOptions();
        idGeneratorOptions.setMonomer(false); //è®¾ç½®å•æœºæ¨¡å¼ä¸ºfalse
        idGeneratorOptions.setWorkerId((short) 6); //è®¾ç½®æœºå™¨ç ä¸º6
        idGeneratorOptions.setWorkerIdBitLength((byte) 3); //è®¾ç½®æœºå™¨ç ä½é•¿ä¸º3
        //è£…è½½idç”Ÿæˆå™¨çš„é…ç½®æ–‡ä»¶
        return new YitIdGenerator(idGeneratorOptions);
    }
}
```



#### 5.2.1ã€é…ç½®ä¼˜å…ˆçº§

è¯·æ³¨æ„æˆ‘ä»¬çš„ä¼˜å…ˆçº§ï¼Œæœ¬åœ°é…ç½®æ–‡ä»¶é…ç½®ï¼ˆæœ¬åœ°yamlæ–‡ä»¶æˆ–propertiesæ–‡ä»¶ï¼‰ **<** é…ç½®ç±»é…ç½®ï¼ˆè‡ªå·±åˆ›å»ºbeanï¼‰ **<** é…ç½®ä¸­å¿ƒé…ç½®ï¼ˆå¦‚nacos-configé…ç½®ï¼‰



#### 5.3ã€å‚æ•°è¯¦è§£

â„**Method**ï¼Œè¡¨ç¤ºä½¿ç”¨ä»€ä¹ˆç®—æ³•ï¼Œé»˜è®¤å€¼ä¸º1ï¼Œè¡¨ç¤ºä½¿ç”¨é›ªèŠ±æ¼‚ç§»ç®—æ³•ï¼Œ2è¡¨ç¤ºä½¿ç”¨ä¼ ç»Ÿé›ªèŠ±ç®—æ³•ã€‚ä½†ä»å»ºè®®ä½ ä½¿ç”¨é›ªèŠ±æ¼‚ç§»ç®—æ³•ï¼ˆMethod=1ï¼Œé»˜è®¤çš„ï¼‰ï¼Œæ¯•ç«Ÿå®ƒå…·æœ‰æ›´å¥½çš„ä¼¸ç¼©åŠ›å’Œæ›´é«˜çš„æ€§èƒ½ã€‚

â„**Monomer**ï¼Œè¡¨ç¤ºæ˜¯å¦ä¸ºå•æœºæ¨¡å¼ï¼Œé»˜è®¤ä¸ºtrueè¡¨ç¤ºä¸ºå•æœºæ¨¡å¼ï¼Œåœ¨å•æœºæ¨¡å¼ä¸‹ï¼Œæœºå™¨ç ä½é•¿ä¸º1ï¼Œæœºå™¨ç ä¸º0ã€‚ä½†ä¼˜å…ˆä½¿ç”¨ç”¨æˆ·é…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ é…ç½®äº†å…¶ä»–çš„æœºå™¨ç å’Œæœºå™¨ç ä½é•¿ï¼Œä¼˜å…ˆä½¿ç”¨ä½ é…ç½®çš„ã€‚

â„ ***WorkerIdBitLength***ï¼Œæœºå™¨ç ä½é•¿ï¼Œå†³å®š WorkerId çš„æœ€å¤§å€¼ï¼Œ**é»˜è®¤å€¼6**ï¼Œå–å€¼èŒƒå›´ [1, 19]ï¼Œå®é™…ä¸Šæœ‰äº›è¯­è¨€é‡‡ç”¨ æ— ç¬¦å· ushort (uint16) ç±»å‹æ¥æ”¶è¯¥å‚æ•°ï¼Œæ‰€ä»¥æœ€å¤§å€¼æ˜¯16ï¼Œå¦‚æœæ˜¯é‡‡ç”¨ æœ‰ç¬¦å· short (int16)ï¼Œåˆ™æœ€å¤§å€¼ä¸º15ã€‚

â„ **WorkerId**ï¼Œæœºå™¨ç ï¼Œ**æœ€é‡è¦å‚æ•°**ï¼Œæ— é»˜è®¤å€¼ï¼Œå¿…é¡» **å…¨å±€å”¯ä¸€**ï¼ˆæˆ–ç›¸åŒ DataCenterId å†…å”¯ä¸€ï¼‰ï¼Œå¿…é¡» **ç¨‹åºè®¾å®š**ï¼Œç¼ºçœæ¡ä»¶ï¼ˆWorkerIdBitLengthå–é»˜è®¤å€¼ï¼‰æ—¶æœ€å¤§å€¼63ï¼Œç†è®ºæœ€å¤§å€¼ 2^WorkerIdBitLength-1ï¼ˆä¸åŒå®ç°è¯­è¨€å¯èƒ½ä¼šé™å®šåœ¨ 65535 æˆ– 32767ï¼ŒåŸç†åŒ WorkerIdBitLength è§„åˆ™ï¼‰ã€‚ä¸åŒæœºå™¨æˆ–ä¸åŒåº”ç”¨å®ä¾‹ **ä¸èƒ½ç›¸åŒ**ï¼Œä½ å¯é€šè¿‡åº”ç”¨ç¨‹åºé…ç½®è¯¥å€¼ï¼Œä¹Ÿå¯é€šè¿‡è°ƒç”¨å¤–éƒ¨æœåŠ¡è·å–å€¼ã€‚é’ˆå¯¹è‡ªåŠ¨æ³¨å†ŒWorkerIdéœ€æ±‚ï¼Œæœ¬ç®—æ³•æä¾›é»˜è®¤å®ç°ï¼šé€šè¿‡ redis è‡ªåŠ¨æ³¨å†Œ WorkerId çš„åŠ¨æ€åº“ï¼Œè¯¦è§â€œTools\AutoRegisterWorkerIdâ€ã€‚

**ç‰¹åˆ«æç¤º**ï¼šå¦‚æœä¸€å°æœåŠ¡å™¨éƒ¨ç½²å¤šä¸ªç‹¬ç«‹æœåŠ¡ï¼Œéœ€è¦ä¸ºæ¯ä¸ªæœåŠ¡æŒ‡å®šä¸åŒçš„ WorkerIdã€‚

â„ ***SeqBitLength***ï¼Œåºåˆ—æ•°ä½é•¿ï¼Œ**é»˜è®¤å€¼6**ï¼Œå–å€¼èŒƒå›´ [3, 21]ï¼ˆå»ºè®®ä¸å°äº4ï¼‰ï¼Œå†³å®šæ¯æ¯«ç§’åŸºç¡€ç”Ÿæˆçš„IDä¸ªæ•°ã€‚è§„åˆ™è¦æ±‚ï¼šWorkerIdBitLength + SeqBitLength ä¸è¶…è¿‡ 22ã€‚

â„ ***MinSeqNumber***ï¼Œæœ€å°åºåˆ—æ•°ï¼Œé»˜è®¤å€¼5ï¼Œå–å€¼èŒƒå›´ [5, MaxSeqNumber]ï¼Œæ¯æ¯«ç§’çš„å‰5ä¸ªåºåˆ—æ•°å¯¹åº”ç¼–å·0-4æ˜¯ä¿ç•™ä½ï¼Œå…¶ä¸­1-4æ˜¯æ—¶é—´å›æ‹¨ç›¸åº”é¢„ç•™ä½ï¼Œ0æ˜¯æ‰‹å·¥æ–°å€¼é¢„ç•™ä½ã€‚

â„ ***MaxSeqNumber***ï¼Œæœ€å¤§åºåˆ—æ•°ï¼Œè®¾ç½®èŒƒå›´ [MinSeqNumber, 2^SeqBitLength-1]ï¼Œé»˜è®¤å€¼0ï¼ŒçœŸå®æœ€å¤§åºåˆ—æ•°å–æœ€å¤§å€¼ï¼ˆ2^SeqBitLength-1ï¼‰ï¼Œä¸ä¸º0æ—¶ï¼Œå–å…¶ä¸ºçœŸå®æœ€å¤§åºåˆ—æ•°ï¼Œä¸€èˆ¬æ— éœ€è®¾ç½®ï¼Œé™¤éå¤šæœºå…±äº«WorkerIdåˆ†æ®µç”ŸæˆIDï¼ˆæ­¤æ—¶è¿˜è¦æ­£ç¡®è®¾ç½®æœ€å°åºåˆ—æ•°ï¼‰ã€‚

â„ ***BaseTime***ï¼ŒåŸºç¡€æ—¶é—´ï¼ˆä¹Ÿç§°ï¼šåŸºç‚¹æ—¶é—´ã€åŸç‚¹æ—¶é—´ã€çºªå…ƒæ—¶é—´ï¼‰ï¼Œæœ‰é»˜è®¤å€¼ï¼ˆ2020å¹´ï¼‰ï¼Œæ˜¯æ¯«ç§’æ—¶é—´æˆ³ï¼ˆæ˜¯æ•´æ•°ï¼Œ.NETæ˜¯DatetTimeç±»å‹ï¼‰ï¼Œä½œç”¨æ˜¯ï¼šç”¨ç”ŸæˆIDæ—¶çš„ç³»ç»Ÿæ—¶é—´ä¸åŸºç¡€æ—¶é—´çš„å·®å€¼ï¼ˆæ¯«ç§’æ•°ï¼‰ä½œä¸ºç”ŸæˆIDçš„æ—¶é—´æˆ³ã€‚åŸºç¡€æ—¶é—´ä¸€èˆ¬æ— éœ€è®¾ç½®ï¼Œå¦‚æœè§‰å¾—é»˜è®¤å€¼å¤ªè€ï¼Œä½ å¯ä»¥é‡æ–°è®¾ç½®ï¼Œä¸è¿‡è¦æ³¨æ„ï¼Œè¿™ä¸ªå€¼ä»¥åæœ€å¥½ä¸å˜ã€‚



### 6ã€å…¶ä»–ç»†èŠ‚



#### 6.1ã€idç»„æˆ

- æœ¬ç®—æ³•ç”Ÿæˆçš„IDç”±3éƒ¨åˆ†ç»„æˆï¼ˆæ²¿ç”¨é›ªèŠ±ç®—æ³•å®šä¹‰ï¼‰ï¼š
- +-------------------------+--------------+----------+
- | 1.ç›¸å¯¹åŸºç¡€æ—¶é—´çš„æ—¶é—´å·® | 2.WorkerId | 3.åºåˆ—æ•° |
- +-------------------------+--------------+----------+



![2](https://cdn.jsdelivr.net/gh/lmlx6688/img1/SnowFlake/2.png)



#### 6.2ã€é›†æˆç®—æ³•

1ï¸âƒ£ ç”¨å•ä¾‹æ¨¡å¼è°ƒç”¨ã€‚å¤–éƒ¨é›†æˆæ–¹ä½¿ç”¨æ›´å¤šçš„å®ä¾‹å¹¶è¡Œè°ƒç”¨æœ¬ç®—æ³•ï¼Œä¸ä¼šå¢åŠ IDäº§å‡ºæ•ˆèƒ½ï¼Œå› ä¸ºæœ¬ç®—æ³•é‡‡ç”¨å•çº¿ç¨‹ç”ŸæˆIDã€‚

2ï¸âƒ£ æŒ‡å®šå”¯ä¸€çš„ WorkerIdã€‚å¿…é¡»ç”±å¤–éƒ¨ç³»ç»Ÿç¡®ä¿ WorkerId çš„å…¨å±€å”¯ä¸€æ€§ï¼Œå¹¶èµ‹å€¼ç»™æœ¬ç®—æ³•å…¥å£æ–¹æ³•ã€‚

3ï¸âƒ£ å•æœºå¤šå®ä¾‹éƒ¨ç½²æ—¶ä½¿ç”¨ä¸åŒ WorkerIdã€‚å¹¶éæ‰€æœ‰å®ç°éƒ½æ”¯æŒè·¨è¿›ç¨‹çš„å¹¶å‘å”¯ä¸€ï¼Œä¿é™©èµ·è§ï¼Œåœ¨åŒä¸€ä¸»æœºä¸Šéƒ¨ç½²å¤šåº”ç”¨å®ä¾‹æ—¶ï¼Œè¯·ç¡®ä¿å„ WorkerId å”¯ä¸€ã€‚

4ï¸âƒ£ å¼‚å¸¸å¤„ç†ã€‚ç®—æ³•ä¼šæŠ›å‡ºæ‰€æœ‰ Exceptionï¼Œå¤–éƒ¨ç³»ç»Ÿåº” catch å¼‚å¸¸å¹¶åšå¥½åº”å¯¹å¤„ç†ï¼Œä»¥å…å¼•å‘æ›´å¤§çš„ç³»ç»Ÿå´©æºƒã€‚

5ï¸âƒ£ è®¤çœŸç†è§£ IdGeneratorOptions çš„å®šä¹‰ï¼Œè¿™å¯¹é›†æˆå’Œä½¿ç”¨æœ¬ç®—æ³•æœ‰å¸®åŠ©ã€‚

6ï¸âƒ£ ä½¿ç”¨é›ªèŠ±æ¼‚ç§»ç®—æ³•ã€‚è™½ç„¶ä»£ç é‡ŒåŒ…å«äº†ä¼ ç»Ÿé›ªèŠ±ç®—æ³•çš„å®šä¹‰ï¼Œå¹¶ä¸”ä½ å¯ä»¥åœ¨å…¥å£å¤„æŒ‡å®šï¼ˆMethod=2ï¼‰æ¥å¯ç”¨ä¼ ç»Ÿç®—æ³•ï¼Œä½†ä»å»ºè®®ä½ ä½¿ç”¨é›ªèŠ±æ¼‚ç§»ç®—æ³•ï¼ˆMethod=1ï¼Œé»˜è®¤çš„ï¼‰ï¼Œæ¯•ç«Ÿå®ƒå…·æœ‰æ›´å¥½çš„ä¼¸ç¼©åŠ›å’Œæ›´é«˜çš„æ€§èƒ½ã€‚

7ï¸âƒ£ ä¸è¦ä¿®æ”¹æ ¸å¿ƒç®—æ³•ã€‚æœ¬ç®—æ³•å†…éƒ¨å‚æ•°è¾ƒå¤šï¼Œé€»è¾‘è¾ƒä¸ºå¤æ‚ï¼Œåœ¨ä½ å°šæœªæŒæ¡æ ¸å¿ƒé€»è¾‘æ—¶ï¼Œè¯·å‹¿ä¿®æ”¹æ ¸å¿ƒä»£ç ä¸”ç”¨äºç”Ÿäº§ç¯å¢ƒï¼Œé™¤éé€šè¿‡å¤§é‡ç»†è‡´ã€ç§‘å­¦çš„æµ‹è¯•éªŒè¯ã€‚

8ï¸âƒ£ åº”ç”¨åŸŸå†…é…ç½®ç­–ç•¥ç›¸åŒã€‚å½“ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œé¡¹ç›®éœ€è¦ä»ç¨‹åºæŒ‡å®š WorkerId è½¬åˆ°è‡ªåŠ¨æ³¨å†Œ WorkerId æ—¶ï¼Œè¯·ç¡®ä¿åŒä¸€åº”ç”¨åŸŸå†…æ‰€æœ‰åœ¨ç”¨å®ä¾‹é‡‡ç”¨ä¸€è‡´çš„é…ç½®ç­–ç•¥ï¼Œè¿™ä¸ä»…ä»…é’ˆå¯¹ WorkerIdï¼Œä¹ŸåŒ…å«å…¶ä»–æ‰€æœ‰é…ç½®å‚æ•°ã€‚

9ï¸âƒ£ ç®¡ç†å¥½æœåŠ¡å™¨æ—¶é—´ã€‚é›ªèŠ±ç®—æ³•ä¾èµ–ç³»ç»Ÿæ—¶é—´ï¼Œä¸è¦æ‰‹å·¥å¤§å¹…åº¦å›è°ƒæ“ä½œç³»ç»Ÿæ—¶é—´ã€‚å¦‚æœä¸€å®šè¦è°ƒæ•´ï¼Œåˆ‡è®°ï¼šç¡®ä¿æœåŠ¡å†æ¬¡å¯åŠ¨æ—¶çš„ç³»ç»Ÿæ—¶é—´å¤§äºæœ€åä¸€æ¬¡å…³é—­æ—¶çš„æ—¶é—´ã€‚ï¼ˆæ³¨ï¼šä¸–ç•Œçº§æˆ–ç½‘ç»œçº§çš„æ—¶é—´åŒæ­¥æˆ–å›æ‹¨ï¼Œå¼•èµ·çš„ç³»ç»Ÿæ—¶é—´å°å¹…åº¦å˜åŒ–ï¼Œå¯¹æœ¬ç®—æ³•æ²¡å½±å“ï¼‰



#### 6.3ã€é…ç½®å˜æ›´

é…ç½®å˜æ›´æŒ‡æ˜¯ç³»ç»Ÿè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œå†è°ƒæ•´è¿è¡Œå‚æ•°ï¼ˆIdGeneratorOptions é€‰é¡¹å€¼ï¼‰ï¼Œè¯·æ³¨æ„ï¼š

ğŸ”´ 1.æœ€é‡è¦çš„ä¸€æ¡åŸåˆ™æ˜¯ï¼šBaseTime **åªèƒ½å¾€å‰**ï¼ˆæ¯”è€å€¼æ›´å°ã€è·ç¦»ç°åœ¨æ›´è¿œï¼‰èµ‹å€¼ï¼ŒåŸå› æ˜¯å¾€åèµ‹å€¼æå¤§å¯èƒ½äº§ç”Ÿç›¸åŒçš„æ—¶é—´æˆ³ã€‚[**ä¸æ¨è**åœ¨ç³»ç»Ÿè¿è¡Œä¹‹åè°ƒæ•´ BaseTime]

ğŸ”´ 2.ä»»ä½•æ—¶å€™å¢åŠ  WorkerIdBitLength æˆ– SeqBitLengthï¼Œéƒ½æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯æ…ç”¨ â€œå‡å°â€çš„æ“ä½œï¼Œå› ä¸ºè¿™å¯èƒ½å¯¼è‡´åœ¨æœªæ¥æŸå¤©ç”Ÿæˆçš„ ID ä¸è¿‡å»è€é…ç½®æ—¶ç›¸åŒã€‚[å…è®¸åœ¨ç³»ç»Ÿè¿è¡Œä¹‹å**å¢åŠ **ä»»ä½•ä¸€ä¸ª BitLength å€¼]

ğŸ”´ 3.å¦‚æœå¿…é¡»å‡å° WorkerIdBitLength æˆ– SeqBitLength å…¶ä¸­çš„ä¸€é¡¹ï¼Œä¸€å®šè¦æ»¡è¶³ä¸€ä¸ªæ¡ä»¶ï¼šæ–°çš„ä¸¤ä¸ª BitLength ä¹‹å’Œè¦å¤§äº è€çš„å€¼ä¹‹å’Œã€‚[**ä¸æ¨è**åœ¨è¿è¡Œä¹‹åç¼©å°ä»»ä½•ä¸€ä¸ª BitLength å€¼]

ğŸ”´ 4.ä¸Šè¿°3æ¡è§„åˆ™ï¼Œå¹¶æœªåœ¨æœ¬ç®—æ³•å†…åšé€»è¾‘æ§åˆ¶ï¼Œé›†æˆæ–¹åº”æ ¹æ®ä¸Šè¿°è§„åˆ™åšå¥½å½±å“è¯„ä¼°ï¼Œç¡®è®¤æ— è¯¯åï¼Œå†å®æ–½é…ç½®å˜æ›´ã€‚



#### 6.4ã€æœ€ä½³å®è·µ

1. æœºå™¨ç è¯·åŠ¡å¿…å”¯ä¸€ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨redisè‡ªå¢ç»“åˆnacos-configæˆ–å…¶ä»–æ–¹æ³•è¿›è¡Œè‡ªåŠ¨é…ç½®ã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥ç®—æ³•æœ¬èº«ç­‰ç‰¹æ€§è¿›è¡Œk8sé›†æˆã€‚
2. åºæ•°ä½ç›´æ¥å†³å®šäº†æœ¬ç®—æ³•ä¸€æ¯«ç§’å†…èƒ½å¤Ÿç”Ÿæˆå¤šå°‘idï¼Œå¦‚æœè¶…è¿‡æ­¤æ•°é‡ï¼Œåˆ™ä¼šé˜»å¡ä½ã€‚è¯·åŠ¡å¿…æµ‹è¯•å¥½ä½ çš„å¹¶å‘ã€‚
2. æœ¬åŒ…æ”¯æŒåŠ¨æ€é…ç½®åŠ è½½beanï¼Œä½†æˆ‘ä»¬å¼ºçƒˆå»ºè®®åŠ¨æ€é…ç½®ä¸­å¿ƒå°†æ‰€æœ‰é…ç½®éƒ½é…ç½®ä¸Šï¼Œè€Œä¸æ˜¯ä¸é…ç½®è€Œä½¿ç”¨é»˜è®¤ã€‚